{% extends "admin/base.html" %}

{% block admin_content %}
<div class="dashboard-container">
    <!-- Header Section -->
    <div class="admin-card">
        <h2>All Users</h2>
        <p>View and manage all registered users in the system. Monitor user activity and account statuses.</p>
    </div>

    {% if users %}
        <!-- User Statistics -->
        <div class="admin-card">
            <h3>User Statistics</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 16px;">
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #667eea;">{{ users|length }}</div>
                    <div style="color: var(--drac-comment); font-size: 0.9rem;">Total Users</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #4ade80;">
                        {{ users|selectattr('role', 'equalto', 'doctor')|list|length }}
                    </div>
                    <div style="color: var(--drac-comment); font-size: 0.9rem;">Doctors</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #ff6b9d;">
                        {{ users|selectattr('role', 'equalto', 'patient')|list|length }}
                    </div>
                    <div style="color: var(--drac-comment); font-size: 0.9rem;">Patients</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #ffb86c;">
                        {{ users|selectattr('status', 'equalto', 'pending')|list|length }}
                    </div>
                    <div style="color: var(--drac-comment); font-size: 0.9rem;">Pending</div>
                </div>
            </div>
        </div>

        <!-- Users Table -->
        <div class="admin-card">
            <h3>User Directory</h3>
            <div style="overflow-x: auto;">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>User ID</th>
                            <th>Full Name</th>
                            <th>Username</th>
                            <th>Contact</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Registration Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>
                                <div style="font-weight: 600; color: var(--drac-foreground);">#{{ user.id }}</div>
                            </td>
                            <td>
                                <div style="font-weight: 600; color: var(--drac-foreground);">{{ user.fullname }}</div>
                            </td>
                            <td>
                                <div style="color: var(--drac-foreground);">{{ user.username }}</div>
                            </td>
                            <td>
                                <div style="color: var(--drac-foreground);">{{ user.email }}</div>
                                {% if user.phone %}
                                <div style="color: var(--drac-comment); font-size: 0.85rem;">{{ user.phone }}</div>
                                {% endif %}
                            </td>
                            <td>
                                {% if user.role == 'admin' %}
                                    <span class="status-badge status-admin">Admin</span>
                                {% elif user.role == 'doctor' %}
                                    <span class="status-badge status-doctor">Doctor</span>
                                {% else %}
                                    <span class="status-badge status-patient">Patient</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if user.status %}
                                    <span class="status-badge status-{{ user.status }}">
                                        {{ user.status.title() }}
                                    </span>
                                {% else %}
                                    <span class="status-badge status-approved">Approved</span>
                                {% endif %}
                            </td>
                            <td>
                                <div style="color: var(--drac-foreground);">{{ user.created_at[:10] if user.created_at else 'N/A' }}</div>
                                <div style="color: var(--drac-comment); font-size: 0.8rem;">{{ user.created_at[11:16] if user.created_at else '' }}</div>
                            </td>
                            <td>
                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                    {% if user.role == 'doctor' and user.status == 'pending' %}
                                        <form method="post" action="{{ url_for('admin_approve_doctor', doctor_id=user.id) }}" style="display: inline;">
                                            <button type="submit" name="action" value="approve" class="btn-admin btn-admin-success" style="padding: 6px 12px; font-size: 0.8rem;">
                                                âœ“ Approve
                                            </button>
                                        </form>
                                    {% endif %}
                                    {% if user.username != 'admin' %}
                                        <form method="post" action="{{ url_for('admin_ban_user', user_id=user.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to ban and permanently delete this user? This action cannot be undone.')">
                                            <button type="submit" class="btn-admin btn-admin-danger" style="padding: 6px 12px; font-size: 0.8rem;">
                                                Ban User
                                            </button>
                                        </form>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% else %}
        <!-- No Users -->
        <div class="admin-card">
            <div style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 3rem; margin-bottom: 16px;">ðŸ‘¥</div>
                <h3 style="margin: 0 0 12px 0; color: var(--drac-foreground);">No Users Found</h3>
                <p style="color: var(--drac-comment); margin: 0; font-size: 1rem;">
                    No users have registered in the system yet.
                </p>
            </div>
        </div>
    {% endif %}
</div>

<script>
</script>
{% endblock %}